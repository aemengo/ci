#!/usr/bin/env bash

source ci/scripts/common.sh

set -o errexit
set -o nounset
set -o pipefail

set -x

docker load -i golang-image/image
docker tag "$(cat golang-image/image-id)" "golang"

mv pack-linux-binary/pack-*-linux pack-linux-binary/pack
pack_path=$PWD/pack-linux-binary/pack
chmod +x ${pack_path}

cd pack-repo
docker_run -e "PACK_PATH=/tmp/pack" -v "$pack_path":/tmp/pack golang go test -mod=vendor -tags=acceptance -v -count=1 -parallel=1 -timeout=0 ./acceptance
