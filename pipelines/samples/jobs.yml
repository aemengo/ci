jobs:
  - name: create-samples-builder
    public: true
    plan:
      - aggregate:
          - get: pack-github-release
            trigger: true
            params:
                globs: [pack-*-linux.tgz]
          - get: samples-repo
            trigger: true
          - get: sample-java-app
            trigger: true
          - get: ci
            params:
              submodules: none
          - get: samples-version
            params:
              pre: rc
      - task: extract-pack
        file: ci/tasks/extract-pack-release/task.yml
        privileged: true
      - task: create-builder
        file: ci/tasks/create-samples-builder/task.yml
        privileged: true
      - put: samples-image
        params:
          load_file: samples-tar/samples.tar
          load_repository: cnbs/samples
          load_tag: dev
          tag_file: samples-version/version
          tag_as_latest: true
      - put: samples-version
        params:
          file: samples-version/version
